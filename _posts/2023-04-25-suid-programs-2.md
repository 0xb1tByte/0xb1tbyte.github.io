---
layout: post
published: true
title: SUID Programs Part 2
date: '2023-04-25'
tags:
  - Linux
  - Privilege-Escalation
  - Arabic-Article
---

  <div dir="rtl" markdown="1">

ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชู
 
ุงูููุงูุฉ ูุฐู ุฅุณุชููุงู [ููููุงูุฉ ุงูุณุงุจูุฉ](https://0xb1tbyte.github.io/2022-12-31-suid-programs-1/) ุญูู ููุถูุน ุงูู Set-UID Program 

ุณููุงูุด ุงูููุงุท ุงูุขุชูุฉ ูู ูุฐู ุงูููุงูุฉ : 
- ุญุงูุงุช ุฅุณุชุบูุงู ุฏุงูุฉ `system()` ูู ุงูู Set-UID Program  
  - ููู ุชุจุฏู ููู ุงูู `uid` ู ุงูู `euid` ูู ุงูุจุฑุงูุฌ ุงูุนุงุฏูุฉ ููู ุจุฑุงูุฌ ุงูู Set-UID ุ
  - ููู ุชุนูู ุฏุงูุฉ `setuid()` ูู ุจุฑุงูุฌ ุงูู Set-UID ุ
  - ููู ุชุนูู ุฏุงูุฉ `system()` ุ ูู ููุฏุงูุฉ ุญุงูุงุช ุฎุงุตุฉ ุถูู ุจุฑุงูุฌ ุงูู Set-UID ุ
  
ููุจุฏุฃ ุจุณู ุงููู 
  
# ุญุงูุงุช ุฅุณุชุบูุงู ุฏุงูุฉ `system()` ูู ุงูู Set-UID Program
ุฐูุฑูุง ูู ุงูููุงูุฉ ุงูุณุงุจูุฉ ุงูููุฏ ุงูุชุงูู   
  
  </div>

```c
  #include <stdio.h>
  #include <stdlib.h>
  #include <unistd.h>
  int main () 
  {
        setuid (0);
        system("ls");
  }
```

 <div dir="rtl" markdown="1">
ูุดุฑุญูุง ูุซุงู ุนูู ุทุฑููุฉ ุฅุณุชุบูุงูู ูู ุญุงู ุชู ุชูุนูู ุงูู Set-UID bit ููุจุฑูุงูุฌุ ููููุง ูู ููุตูู ูู ุงูููุฏ ููุณู ููู ููุงูุด ุงูุญุงูุงุช ุงูุชู ูุง ูููููุง ูููุง ุฅุณุชุบูุงู ุฏุงูุฉ `system()` ูู ุงูู Set-UID Program 

ููุงุญุธ ูู ุงูููุฏ ุฃุนูุงู ุฃูู ูุจู ูุฏุงุก ุฏุงูุฉ `system()` ููุฌุฏ ูุฏุงุก ูุฏุงูุฉ `setuid()` ูููุงุญุธ ุฃููุง ูููุง ุจุชูุฑูุฑ ุงููููุฉ `ุตูุฑ` ููุฏุงูุฉ

ูุจู ุฃู ูุดุฑุญ ุนูู ุงูุฏุงูุฉ ููููู ุจุชุนุทูููุง ูู ุงูููุฏ ููุญุงูู ุฅุณุชุบูุงู ุงูููุฏ ููุง ูุนููุง ูู ุงูููุงูุฉ ุงูุณุงุจูุฉ

ุณูุตุจุญ ุงูููุฏ ูุงูุขุชู : 

 </div>
 

```c
  #include <stdio.h>
  #include <stdlib.h>
  #include <unistd.h>
  int main () 
  {
        //setuid (0);
        system("ls");
  }
```
 



 <div dir="rtl" markdown="1"> 
 
ููุงุญุธ ุฃูู ูู ูุนุฏ ุจุฅููุงููุง ุฅุณุชุบูุงู ุฏุงูุฉ `system()`ุจุฏูู ูุฏุงุก ุงูุฏุงูุฉ `setuid()` 
 
 ![1](https://raw.githubusercontent.com/0xb1tByte/0xb1tbyte.github.io/master/assets/media/suid-2/1.png#center)
 
ููู ุญุงู ุฃุนุฏูุง ุงูููุฏ ูุญุงูุชู ุงูุฃููู ุณูุณุชุทูุน ุฅุณุชุบูุงู ูุฌูุฏ ุฏุงูุฉ `system()` ูู ุงูู Set-UID Program 
 
 ![2](https://raw.githubusercontent.com/0xb1tByte/0xb1tbyte.github.io/master/assets/media/suid-2/2.png#center)
 
ูุจุฏู ุฃู ูุฌูุฏ ุงูุฏุงูุฉ `setuid()` ุนุงูู ููู ูุฅุณุชุบูุงู ุงูู `system()` ุถูู ุงูู Set-UID Program 

ููุนูุฏ ูุชุนุฑูู ุงูุฏุงูุฉ `setuid()` 
 </div>
 
> `setuid()` sets the effective user ID of the calling process.
> 

 

 <div dir="rtl" markdown="1"> 
 
ุฅุฐูุง ุงูุฏุงูุฉ ุชููู ุจุนูู set ููููุฉ ุงูู Effective User ID ููุนูููุฉ
 
ููููุง ูููุง ุจุงูุฃุณุงุณ ุจุชูุนูู ุงูู Set-UID bit ูู ุงูุจุฑูุงูุฌ ูููุชุฑุถ ุฃู ูุนูู ุงูุจุฑูุงูุฌ ููู ุตูุงุญูุงุช ุงูู owner ( ูู ุญุงูุชูุง ูู ุงูู root ) 

ูููุงุฐุง ูุฌุจ ุนูููุง ุชูุฑุงุฑ ูุฐู ุงูุนูููุฉ ูุฑุฉ ุฃุฎุฑู ุนู ุทุฑูู ูุฏุงุก ุงูุฏุงูุฉ `setuid()` ูู ููุฏ ุงูู Set-UID Program ุ 

ูู ุงูุญูููุฉ ุงููุซุงู ุฃุนูุงู ูุงูุณุคุงู ูุฐุง ูุชุฌ ุฎูุงู ุฑุญูุฉ ุชุนููู ููู Set-UID Program 

ูู ุงูุจุฏุงูุฉ ูุชุจุช ุงูููุฏ ุจุฏูู ูุฏุงุก ุฏุงูุฉ `setuid()` ูุฃูู ุญุณุจ ูููู ุงูุจุณูุท ุจุฑุงูุฌ ุงูู Set-UID ุณุชุนูู ุถูู ุตูุงุญูุงุช ุงูู owner ููุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุนุฑูู ูููุฉ ุงูู Effective User ID ุจุดูู ุตุฑูุญ ุถูู ุงูููุฏ 

ุญุชู ูุตูุช ููุฅุณุชุบูุงู ููู ุฃุชููู ูู ุฅุณุชุบูุงู ุงูู `system()` ุฅูุง ุจูุฌูุฏ ุฏุงูุฉ `setuid()` ูู ุงูููุฏ 

ูููุนุฑูุฉ ุณุจุจ ูุฌูุฏ ุฏุงูุฉ `setuid()` ุนูู ุงูุฑุบู ูู ุฃู ุงูู Set-UID bit ูููุนููุฉ ูู ุงูุจุฑูุงูุฌ ููุช ุจุงูุจุญุซ ูููู ูุฐู ุงูููุงุท : 
- ููู ุชุจุฏู ููู ุงูู `uid` ู ุงูู `euid` ูู ุงูุจุฑุงูุฌ ุงูุนุงุฏูุฉ ููู ุจุฑุงูุฌ ุงูู Set-UID ุ 
- ููู ุชุนูู ุฏุงูุฉ `setuid()` ูู ุจุฑุงูุฌ ุงูู Set-UID ุ
- ููู ุชุนูู ุฏุงูุฉ `system()` ุ ูู ููุฏุงูุฉ ุญุงูุงุช ุฎุงุตุฉ ุถูู ุจุฑุงูุฌ ุงูู Set-UID ุ 
 
ููุจุฏุฃ ุงูุงุฌุงุจุฉ ุนูู ูุฐู ุงูุฃุณุฆูุฉ

## ููู ุชุจุฏู ููู ุงูู `uid` ู ุงูู `euid` ูู ุงูุจุฑุงูุฌ ุงูุนุงุฏูุฉ ููู ุจุฑุงูุฌ ุงูู Set-UID ุ
ูุณุชุทูุน ุฅุณุชุฎุฏุงู ุงูููุฏ ุงูุชุงูู ูููุตูู ูููู ุงูู `uid` ู `euid`

</div>


```c
#include <stdio.h>
#include <unistd.h>
  int main () 
  {
  int real = getuid();
  int euid = geteuid();
  printf("The REAL UID =: %d\n", real);
  printf("The EFFECTIVE UID =: %d\n", euid);
  }
```
<div dir="rtl" markdown="1"> 
ููุฑู ููู  ุงูู  `uid` ู `euid` ูู ุงูุจุฑูุงูุฌ ุงูุนุงุฏู ุจุฏูู ุนูู set ููู Set-UID bit 

 ![3](https://raw.githubusercontent.com/0xb1tByte/0xb1tbyte.github.io/master/assets/media/suid-2/3.png#center)

ููุงุญุธ ููุง ุงููุชุบูุฑูู ูุญููุงู ููุณ ุงููููุฉ `1000` ูุงูุชู ุชุนูุฏ ูููุณุชุฎุฏู ุงูุญุงูู `kali` 

ููุฑู ุงูุขู ุงูููู ูู ุญุงูุฉ ุงูู Set-UID Program 

![4](https://raw.githubusercontent.com/0xb1tByte/0xb1tbyte.github.io/master/assets/media/suid-2/4.png#center)

ููุงุญุธ ูู ุญุงูุฉ ุงูู Set-UID Program ุงุฎุชููุช ุงูููู ุ ููููุฉ ุงูู `euid` ุฃุตุจุญุช `0` ููุฐุง ุจุฏููู ูุฃู ูููุง ุจุชูุนูู ุงูู Set-UID bit ูู ุงูุจุฑูุงูุฌ 

ุฅุฐูุง ูุณุชุทูุน ุงูููู : 
- **ูู ุงูุจุฑุงูุฌ ุงูุนุงุฏูุฉ** : ุณุชููู ููุง ุงููููุชูู `uid` ู `euid` ูุชุณุงููุฉ ููุง ุฅุฎุชูุงู ุจููููุง 
- **ูู ุงูู Set-UID Program** : ุณุชููู ูููุฉ ุงูู `uid` ูููุฉ ุงููุณุชุฎุฏู ุงูุฐู ุฃูุดุฃ/ุจุฏุฃ ุงูุนูููุฉ ุ ุจูููุง ูููุฉ ุงูู `euid` ุณุชุฑุฌุน ููููุฉ ุงููุณุชุฎุฏู ุงูุฐู ูููู ุงูุจุฑูุงูุฌ ( owner )

ููููู ุงูุขู ุจุงูุชุนุฏูู ุนูู ุงูููุฏ ูุฅุถุงูุฉ ุฏุงูุฉ `system()` ููุฎุชุจุฑ ุงูููุฏ ูู ูููุง ุงูุญุงูุชูู ุ ุณูููู ุงูููุฏ ูุงูุขุชู : 
</div>

```c
  #include <stdio.h>
  #include <unistd.h>
  #include <stdlib.h>
  int main () 
  {
    int real = getuid();
    int euid = geteuid();
    printf("The REAL UID =: %d\n", real);
    printf("The EFFECTIVE UID =: %d\n", euid);
    system("whoami");
  }
```
<div dir="rtl" markdown="1"> 
ูู ุญุงูุฉ ุงูุจุฑูุงูุฌ ุงูุนุงุฏู ูุฑู ุงูุขุชู : 

![5](https://raw.githubusercontent.com/0xb1tByte/0xb1tbyte.github.io/master/assets/media/suid-2/5.png#center)

ุงููุชุงุฆุฌ ุฃุนูุงู ุชุจุฏู ููุทููุฉ ุญุชู ุงูุขู ุ ููุฑู ุงููุชุงุฆุฌ ูู ุญุงูุฉ ุงูู Set-UID Prgoram 

![6](https://raw.githubusercontent.com/0xb1tByte/0xb1tbyte.github.io/master/assets/media/suid-2/6.png#center)

ููุงุญุธ ูู ุงูุตูุฑุฉ ุฃุนูุงู ุฃู ูููุฉ ุงูู `euid` ุชุณุงูู `0` ( ุงูุจุฑูุงูุฌ ููุชุฑุถ ุฃู ูุนูู ุจุตูุงุญูุฉ ุงูู root ) ููู ุงูุฃูุฑ `whoami` ุงูุฐู ูููุง ุจุชูุฑูุฑู ููุฏุงูุฉ `system()` ูุฎุจุฑูุง ุฃู ุงููุณุชุฎุฏู ููุนูููุฉ ูู `kali`

ูููุง ุฑุฃููุง ุณุงุจููุงุ ูู ูุณุชุทูุน ุฅุณุชุบูุงู ุฏุงูุฉ `system()` ุถูู ุงูู Set-UID Program ุฅูุง ูู ุญุงู ูุฌูุฏ ุฏุงูุฉ `setuid()` 

ููููู ุงูุขู ุจุชุนุฏูู ุงูููุฏ ูุฑุฉ ุฃุฎุฑู ูุฅุถุงูุฉ ุฏุงูุฉ `setuid()` ููุฎุชุจุฑ ููู ุงูู `uid` ู `euid` ูู ูููุง ุงูุญุงูุชูู 

</div>

 <div dir="rtl" markdown="1"> 

## ููู ุชุนูู ุฏุงูุฉ `setuid()` ูู ุจุฑุงูุฌ ุงูู Set-UID ุ

ุณูููู ุจุฅุฎุชุจุงุฑ ููู ุงูู `uid` ู ุงูู `euid` ูุจู ูุจุนุฏ ูุฏุงุก ุฏุงูุฉ `setuid()` ูุณูููู ุงูููุฏ ูุงูุขุชู : 

</div> 

```c
  #include <stdio.h>
  #include <unistd.h>
  #include <stdlib.h>
  int main () 
  {
  int real = getuid();
  int euid = geteuid();
  printf("Before calling setuid() \n");  
  printf("The REAL UID =: %d\n", real);
  printf("The EFFECTIVE UID =: %d\n", euid);
  system("whoami");
  setuid (0);
  int real2 = getuid();
  int euid2 = geteuid();
  printf("After calling setuid() \n");
  printf("The REAL UID =: %d\n", real2);
  printf("The EFFECTIVE UID =: %d\n", euid2);
  system("whoami");
  }
```

<div dir="rtl" markdown="1">  

ูู ุญุงูุฉ ุงูุจุฑูุงูุฌ ุงูุนุงุฏู ุจุงูุชุฃููุฏ ูุฏุงุก ุงูุฏุงูุฉ `setuid()` ยูุชูุฑูุฑ ุงููููุฉ `0` ููุง ูู ููุฌุญ ูุฃู ุงูุจุฑูุงูุฌ ูุง ูููู ุงูุตูุงุญูุฉ ูู ุงูุฃุณุงุณ ุ ููู ููู ุฃุฑุงุฏ ูุนุฑูุฉ ุงูููู ุณุชููู ุงููุชุงุฆุฌ ูุงูุขุชู : 

![7](https://raw.githubusercontent.com/0xb1tByte/0xb1tbyte.github.io/master/assets/media/suid-2/7.png#center)

ููู ุญุงูุฉ ุงูู Set-UID Program ุณุชููู ุงููุชุงุฆุฌ ูุงูุขุชู : 

![8](https://raw.githubusercontent.com/0xb1tByte/0xb1tbyte.github.io/master/assets/media/suid-2/8.png#center)
 
 ุงูุตูุฑุฉ ุฃุนูุงู ุชุฎุจุฑูุง ุจุงููุซูุฑ ุ ููุจุฏุฃ ุจุชูุตูู ูููู ุงููุชุงุฆุฌ : 
 - **ูุจู ูุฏุงุก `setuid()`** : ููุงุญุธ ุฃู ูููุฉ ุงูู `euid` ููุท ุชุบููุฑุช ( ูุฃู ุงูู Set-UID Program ุชุคุซุฑ ููุท ูู ูููุฉ ุงูู `euid` )
 - **ุจุนุฏ ูุฏุงุก `setuid()`** : ููุงุญุธ ุฃู ููุง ุงููุชุบูุฑูู `uid` ู `euid` ุชุบูุฑุช ููููู ูุฃุตุจุญุช `0`

ููู ูู ุชุนุฑูู ุงูุฏุงูุฉ `setuid()` ุงูุฐู ูุฑุฑูุง ุนููู ุณุงุจููุง ุนุฑููุง ุฃู ุงูุฏุงูุฉ ุชุบููุฑ ูููุฉ ุงูู `euid` ูููุงุฐุง ูู ุงูููุฏ ุฃุนูุงู ุจุนุฏ ูุฏุงุก ุงูุฏุงูุฉ ุชุบูุฑุช ูููุฉ ุงูู `uid` ุฃูุถูุง ุ 

ูู ุนุฏูุง ููุตูุญุฉ ุงูุฎุงุตุฉ ุจุงูุฏุงูุฉ ูุฃููููุง ุงููุฑุงุกุฉ ุณูุฌุฏ ุงูุขุชู : 

</div> 

> If the calling process is privileged (more precisely: if the process has the CAP_SETUID capability in its user namespace), the real UID and saved set-user-ID are also set.
> 


 <div dir="rtl" markdown="1"> 

ุชุฎุจุฑูุง ุงูุนุจุงุฑุฉ ุฃุนูุงู ุฃู ุฏุงูุฉ `setuid()` ุณุชููู ุจุชุบููุฑ ููู ุงูู `uid` ูุงูู `euid` ูุนูุง ูู ุญุงู ูุงูุช ุงูุนูููุฉ ุชุนูู ุจุตูุงุญูุฉ ุนุงููุฉ ุ ููุฐุง ููุณูุฑ ุงููุชุงุฆุฌ ุงูุณุงุจูุฉ ุงูุชู ุญุตููุง ุนูููุง

ุฅุฐูุง ูู ุญุงู ุฅุณุชุฎุฏุงู ุฏุงูุฉ `setuid()` ููุงู ุงูุจุฑูุงูุฌ Set-UID Program ูุณูุชู ุชุบููุฑ ูููุง ุงููููุชูู `uid` ู `euid`

ูุฅุฐุง ุนุฏูุง ูุณุคุงููุง ุงูุฃูู : ุณุจุจ ูุฏุงุก ุฏุงูุฉ `setuid()` ูุจู `system()` -ุญุชู ูุณุชุทูุน ุฅุชูุงู ุงูุฅุณุชุบูุงู- ุณููุงุญุธ ุฃูู ุชููููุง ูู ุชูููุฐ ุงูุฅุณุชุบูุงู ูู ุญุงูุฉ ูุงูุช ุฌููุน ููู ุงูู IDs ( `uid` ู `euid` ) ุชุณุงูู ุงูู ID ุงูุฎุงุต ุจุงููุณุชุฎุฏู `root`

ููู ููุง ุนุฑููุง ูู ุงูููุงูุฉ ุงูุณุงุจูุฉ ุงูู access control ููุนูููุฉ ูุฑุชุจุท ุจูููุฉ ุงูู `euid` ููุท ูููุงุฐุง ูู ุญุงูุฉ ุงูู `system()` ุฅุญุชุฌูุง ุฃู ุชููู ูููุฉ ุงูู `uid` ูุณุงููุฉ ูู ID ุงููุณุชุฎุฏู `root` ูุฐูู ุ

ููุฎูุถ ุฃูุซุฑ ูู ุฏุงูุฉ `system()`


## ููู ุชุนูู ุฏุงูุฉ `system()` ุ ูู ููุฏุงูุฉ ุญุงูุงุช ุฎุงุตุฉ ุถูู ุจุฑุงูุฌ ุงูู Set-UID ุ
ููุง ูุนุฑู ุฏุงูุฉ `system()` ุณุชููู ุจุชุดุบูู `/bin/sh` ููู ุซู ุชูุฑูุฑ ุงูู command ( ุฃุทูุน ุนูู [ูุฐู ุงูููุงูุฉ](https://0xb1tbyte.github.io/2019-12-16-Injection-Attacks-on-System/) ููุชูุงุตูู ) 

 </div>
 
 ```bash
execl("/bin/sh", "sh", "-c", command, (char *) NULL);
```

 <div dir="rtl" markdown="1"> 
 ููู ุฃููููุง ุงููุฑุงุกุฉ ูู ูุฑุฌุน ุงูุฏุงูุฉ ุณูุฌุฏ ุงูุนุจุงุฑุฉ ุงูุขุชูุฉ : 

 </div>
 
 > system() will not, in fact, work properly from programs with set-user-ID or set-group-ID privileges on systems on which/bin/sh is bash version 2: as a security measure, bash 2 drops privileges on startup.
> 

 <div dir="rtl" markdown="1"> 
 
 ุชุฎุจุฑูุง ุงูุนุจุงุฑุฉ ุฃู ุฏุงูุฉ `system()` ูู ุชุนูู ููุง ููุชุฑุถ ูููุง ุถูู ุจุฑุงูุฌ ุงูู Set-UID ุ ุงูุณุจุจ ูู ุฐูู ุฃู ุงูู bash ุณุชููู ุจุชุนุทูู ุงูุตูุงุญูุงุช
 
 ููู ุจุญุซูุง ูู ุงููุฑุฌุน ุงูุฎุงุต ุจุงูู `/bin/sh` ุณูุฌุฏ ุงูุชุงูู : 
 </div>
 
 ```
 -i               Specify that the shell is interactive; see below. An
                 implementation may treat specifying the -i option as an
                 error if the real user ID of the calling process does
                 not equal the effective user ID or if the real group ID
                 does not equal the effective group ID.
 ```


```
 ENV             shall be ignored if the real and effective user IDs or real and
                 effective group IDs of the process are different.
 ```

 
 <div dir="rtl" markdown="1"> 
ูุชุถุญ ููุง ูู ุงููุฑุฌุน ุฃุนูุงู ุฃูู ูู ุญุงู ุฅุฎุชูุงู ููู ุงูู `uid` ูุงูู `euid` ุณูููู ุงูู `/bin/sh` ุจุชุนุทูู ุงูุตูุงุญูุฉ 
 
ุฃุนุชูุฏ ุงูุขู ุจุนุฏ ุงูุชูุตูู ุงูุทููู ุฌุฏูุง ูุฌุฏูุง ุงูุฅุฌุงุจุฉ ุงูููุงุฆูุฉ ๐
 
**ูููุฎุต ุฌููุน ูุง ุณุจู:** 
 
ูู ุฃุฑุฏูุง ุฅุณุชุบูุงู ุฏุงูุฉ `system()` ุถูู ุงูู Set-UID Program ูุญู ุจุญุงุฌุฉ ุงูู ูุฏุงุก ุฏุงูุฉ `setuid()` ูุณุจููุง ุญุชู ุชููู ูููุฉ ุงูู `uid` ู ุงูู `euid` ูุชุณุงููุฉ ุจุงูุชุงูู ูู ูููู ุงูู `/bin/sh` ุจุชุนุทูู ุงูุตูุงุญูุงุช ุ ูุฏุงูุฉ `setuid()` ูู ุชููู ุจุงูุชุนุฏูู ุนูู ูููุฉ ุงูู `uid` ุฅูุง ูู ุญุงู ูุงู ุงูุจุฑูุงูุฌ ุฐู ุตูุงุญูุฉ ุนุงููุฉ


ุฎุชุงููุงุ ุฃูุฏ ุงูุฅุดุงุฑุฉ ุจุฃู ูุฐู ุงูููุงูุฉ ุชููุช ูุชุงุจุชูุง ุฎูุงู ุฏุฑุงุณุฉ ูุฐู ุงูููุงุถูุนุ ููู ูุง ุชู ุฐูุฑู ููุง ูุฏ ูุญุชูู ุงูุฎุทุฃุ ููู ุจุงูุฅููุงู ุงูุนูุฏุฉ ุฅูู ุงููุฑุงุฌุน ุงูุชู ุฅุณุชูุฏุช ุนูููุง ูุฐู ุงูููุงูุฉ

ูุฅู ุฃุตุจุช ููู ุชูููู ุงููู ูุญุฏูุ ูุฅู ุฃุฎุทุฃุช ููู ููุณู ูุงูุดูุทุงู

# ุงููุฑุงุฌุน 
- [setuid()](https://man7.org/linux/man-pages/man2/setuid.2.html)
- [system()](https://linux.die.net/man/3/system)
- [/bin/sh](https://man7.org/linux/man-pages/man1/sh.1p.html)

</div>
 
